<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>AndroidZen Pro - Device Management Dashboard</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../static/css/main.css">
    <link rel="stylesheet" href="../static/css/dashboard.css">
    <link rel="stylesheet" href="../static/css/responsive.css">
    <link rel="stylesheet" href="../static/css/modals.css">
    
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js for Charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="../static/images/favicon.ico">
</head>
<body>
    <!-- Navigation Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <i class="fas fa-android"></i>
                <h2>AndroidZen Pro</h2>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        
        <div class="sidebar-menu">
            <ul>
                <li class="menu-item active">
                    <a href="#dashboard" data-section="dashboard">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#devices" data-section="devices">
                        <i class="fas fa-mobile-alt"></i>
                        <span>Devices</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#security" data-section="security">
                        <i class="fas fa-shield-alt"></i>
                        <span>Security</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#performance" data-section="performance">
                        <i class="fas fa-chart-line"></i>
                        <span>Performance</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#network" data-section="network">
                        <i class="fas fa-wifi"></i>
                        <span>Network</span>
                    </a>
                </li>
                <li class="menu-item">
                    <a href="#settings" data-section="settings">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                </li>
            </ul>
        </div>
        
        <div class="sidebar-footer">
            <div class="connection-status" id="connectionStatus">
                <div class="status-indicator" id="statusIndicator"></div>
                <span id="statusText">Connecting...</span>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="main-content" id="mainContent">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <h1 id="pageTitle">Dashboard</h1>
            </div>
            
            <div class="header-right">
                <div class="header-notifications">
                    <button class="notification-btn" id="notificationBtn">
                        <i class="fas fa-bell"></i>
                        <span class="notification-badge" id="notificationBadge">0</span>
                    </button>
                </div>
                
                <div class="header-user">
                    <div class="user-info">
                        <span>Admin</span>
                        <small>Administrator</small>
                    </div>
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard Content -->
        <section class="content-section active" id="dashboard">
            <div class="dashboard-grid">
                <!-- Device Connection Status Card -->
                <div class="widget-card device-status-card">
                    <div class="card-header">
                        <h3>Device Status</h3>
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <div class="card-content">
                        <div class="device-stats">
                            <div class="stat-item">
                                <div class="stat-value" id="connectedDevices">0</div>
                                <div class="stat-label">Connected</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="totalDevices">0</div>
                                <div class="stat-label">Total</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="offlineDevices">0</div>
                                <div class="stat-label">Offline</div>
                            </div>
                        </div>
                        <div class="device-list" id="deviceList">
                            <!-- Device items will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Storage Usage Chart -->
                <div class="widget-card storage-card">
                    <div class="card-header">
                        <h3>Storage Usage</h3>
                        <i class="fas fa-hdd"></i>
                    </div>
                    <div class="card-content">
                        <canvas id="storageChart" width="400" height="200"></canvas>
                        <div class="storage-details" id="storageDetails">
                            <!-- Storage details will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Security Alerts Panel -->
                <div class="widget-card security-card">
                    <div class="card-header">
                        <h3>Security Alerts</h3>
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="card-content">
                        <div class="security-summary">
                            <div class="alert-count critical" id="criticalAlerts">0</div>
                            <div class="alert-count warning" id="warningAlerts">0</div>
                            <div class="alert-count info" id="infoAlerts">0</div>
                        </div>
                        <div class="alert-list" id="alertList">
                            <!-- Security alerts will be populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Performance Metrics Graph -->
                <div class="widget-card performance-card">
                    <div class="card-header">
                        <h3>Performance Metrics</h3>
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="card-content">
                        <canvas id="performanceChart" width="400" height="200"></canvas>
                        <div class="performance-controls">
                            <select id="performanceMetric">
                                <option value="cpu">CPU Usage</option>
                                <option value="memory">Memory Usage</option>
                                <option value="battery">Battery Level</option>
                                <option value="temperature">Temperature</option>
                            </select>
                            <select id="performanceTimeframe">
                                <option value="1h">Last Hour</option>
                                <option value="6h">Last 6 Hours</option>
                                <option value="24h">Last 24 Hours</option>
                                <option value="7d">Last 7 Days</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Network Status Indicators -->
                <div class="widget-card network-card">
                    <div class="card-header">
                        <h3>Network Status</h3>
                        <i class="fas fa-wifi"></i>
                    </div>
                    <div class="card-content">
                        <div class="network-stats">
                            <div class="network-item">
                                <div class="network-icon">
                                    <i class="fas fa-wifi"></i>
                                </div>
                                <div class="network-info">
                                    <div class="network-name">WiFi Connection</div>
                                    <div class="network-status" id="wifiStatus">Connected</div>
                                    <div class="network-details" id="wifiDetails">Signal: Strong</div>
                                </div>
                            </div>
                            <div class="network-item">
                                <div class="network-icon">
                                    <i class="fas fa-ethernet"></i>
                                </div>
                                <div class="network-info">
                                    <div class="network-name">Ethernet</div>
                                    <div class="network-status" id="ethernetStatus">Disconnected</div>
                                    <div class="network-details" id="ethernetDetails">Cable unplugged</div>
                                </div>
                            </div>
                            <div class="network-item">
                                <div class="network-icon">
                                    <i class="fas fa-server"></i>
                                </div>
                                <div class="network-info">
                                    <div class="network-name">Server Connection</div>
                                    <div class="network-status" id="serverStatus">Connected</div>
                                    <div class="network-details" id="serverDetails">Latency: 25ms</div>
                                </div>
                            </div>
                        </div>
                        <canvas id="networkChart" width="400" height="150"></canvas>
                    </div>
                </div>

                <!-- Quick Actions Panel -->
                <div class="widget-card actions-card">
                    <div class="card-header">
                        <h3>Quick Actions</h3>
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="card-content">
                        <div class="action-buttons">
                            <button class="action-btn primary" id="scanDevicesBtn">
                                <i class="fas fa-search"></i>
                                Scan Devices
                            </button>
                            <button class="action-btn secondary" id="refreshDataBtn">
                                <i class="fas fa-sync-alt"></i>
                                Refresh Data
                            </button>
                            <button class="action-btn warning" id="securityScanBtn">
                                <i class="fas fa-shield-alt"></i>
                                Security Scan
                            </button>
                            <button class="action-btn info" id="generateReportBtn">
                                <i class="fas fa-file-alt"></i>
                                Generate Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Other Sections (will be shown/hidden dynamically) -->
        <section class="content-section" id="devices">
            <div class="section-header">
                <h2>Device Management</h2>
                <div class="section-actions">
                    <div class="search-filter">
                        <input type="text" id="deviceSearch" placeholder="Search devices..." class="search-input">
                        <select id="deviceFilter" class="filter-select">
                            <option value="all">All Devices</option>
                            <option value="online">Online Only</option>
                            <option value="offline">Offline Only</option>
                            <option value="android">Android Devices</option>
                        </select>
                    </div>
                    <button class="btn primary" id="addDeviceBtn">
                        <i class="fas fa-plus"></i>
                        Add Device
                    </button>
                    <button class="btn secondary" id="refreshDevicesBtn">
                        <i class="fas fa-sync-alt"></i>
                        Refresh
                    </button>
                </div>
            </div>
            
            <div class="devices-stats">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalDevicesCount">0</div>
                            <div class="stat-label">Total Devices</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon online">
                            <i class="fas fa-circle"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="onlineDevicesCount">0</div>
                            <div class="stat-label">Online</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon offline">
                            <i class="fas fa-circle"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="offlineDevicesCount">0</div>
                            <div class="stat-label">Offline</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon warning">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="issuesDevicesCount">0</div>
                            <div class="stat-label">Issues</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="devices-content">
                <div class="devices-table-container">
                    <table class="devices-table" id="devicesTable">
                        <thead>
                            <tr>
                                <th>
                                    <input type="checkbox" id="selectAllDevices">
                                </th>
                                <th>Device Name</th>
                                <th>Status</th>
                                <th>Model</th>
                                <th>OS Version</th>
                                <th>Battery</th>
                                <th>Storage</th>
                                <th>Last Seen</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="devicesTableBody">
                            <!-- Device rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                    
                    <div class="table-pagination">
                        <button class="btn secondary" id="prevPageBtn" disabled>
                            <i class="fas fa-chevron-left"></i>
                            Previous
                        </button>
                        <span class="pagination-info">
                            Page <span id="currentPage">1</span> of <span id="totalPages">1</span>
                        </span>
                        <button class="btn secondary" id="nextPageBtn" disabled>
                            Next
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
                
                <div class="bulk-actions" id="bulkActions" style="display: none;">
                    <div class="bulk-actions-bar">
                        <span id="selectedCount">0</span> devices selected
                        <div class="bulk-buttons">
                            <button class="btn secondary" id="bulkConnectBtn">
                                <i class="fas fa-plug"></i>
                                Connect Selected
                            </button>
                            <button class="btn warning" id="bulkDisconnectBtn">
                                <i class="fas fa-unlink"></i>
                                Disconnect Selected
                            </button>
                            <button class="btn danger" id="bulkRemoveBtn">
                                <i class="fas fa-trash"></i>
                                Remove Selected
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="content-section" id="security">
            <div class="section-header">
                <h2>Security Center</h2>
            </div>
            <div class="security-content">
                <div class="security-overview">
                    <!-- Security content will be populated by JavaScript -->
                </div>
            </div>
        </section>

        <section class="content-section" id="performance">
            <div class="section-header">
                <h2>Performance Analytics</h2>
            </div>
            <div class="performance-content">
                <div class="performance-overview">
                    <!-- Performance content will be populated by JavaScript -->
                </div>
            </div>
        </section>

        <section class="content-section" id="network">
            <div class="section-header">
                <h2>Network Management</h2>
            </div>
            <div class="network-content">
                <div class="network-overview">
                    <!-- Network content will be populated by JavaScript -->
                </div>
            </div>
        </section>

        <section class="content-section" id="settings">
            <div class="section-header">
                <h2>Settings & Configuration</h2>
            </div>
            <div class="settings-content">
                <div class="settings-tabs">
                    <button class="tab-btn active" data-tab="general">General</button>
                    <button class="tab-btn" data-tab="notifications">Notifications</button>
                    <button class="tab-btn" data-tab="security">Security</button>
                    <button class="tab-btn" data-tab="advanced">Advanced</button>
                </div>
                
                <div class="tab-content active" id="general">
                    <div class="settings-group">
                        <h3>General Settings</h3>
                        <div class="setting-item">
                            <label for="refreshInterval">Auto Refresh Interval (seconds)</label>
                            <input type="number" id="refreshInterval" value="30" min="5" max="300">
                        </div>
                        <div class="setting-item">
                            <label for="theme">Theme</label>
                            <select id="theme">
                                <option value="light">Light</option>
                                <option value="dark">Dark</option>
                                <option value="auto">Auto</option>
                            </select>
                        </div>
                        <div class="setting-item">
                            <label for="language">Language</label>
                            <select id="language">
                                <option value="en">English</option>
                                <option value="es">Spanish</option>
                                <option value="fr">French</option>
                                <option value="de">German</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="notifications">
                    <div class="settings-group">
                        <h3>Notification Settings</h3>
                        <div class="setting-item">
                            <label class="switch">
                                <input type="checkbox" id="enableNotifications" checked>
                                <span class="slider"></span>
                            </label>
                            <span>Enable Notifications</span>
                        </div>
                        <div class="setting-item">
                            <label class="switch">
                                <input type="checkbox" id="securityAlerts" checked>
                                <span class="slider"></span>
                            </label>
                            <span>Security Alerts</span>
                        </div>
                        <div class="setting-item">
                            <label class="switch">
                                <input type="checkbox" id="deviceAlerts" checked>
                                <span class="slider"></span>
                            </label>
                            <span>Device Connection Alerts</span>
                        </div>
                        <div class="setting-item">
                            <label class="switch">
                                <input type="checkbox" id="performanceAlerts">
                                <span class="slider"></span>
                            </label>
                            <span>Performance Alerts</span>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="security">
                    <div class="settings-group">
                        <h3>Security Settings</h3>
                        <div class="setting-item">
                            <label for="sessionTimeout">Session Timeout (minutes)</label>
                            <input type="number" id="sessionTimeout" value="30" min="5" max="480">
                        </div>
                        <div class="setting-item">
                            <label class="switch">
                                <input type="checkbox" id="twoFactorAuth">
                                <span class="slider"></span>
                            </label>
                            <span>Two-Factor Authentication</span>
                        </div>
                        <div class="setting-item">
                            <label class="switch">
                                <input type="checkbox" id="loginNotifications" checked>
                                <span class="slider"></span>
                            </label>
                            <span>Login Notifications</span>
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="advanced">
                    <div class="settings-group">
                        <h3>Advanced Settings</h3>
                        <div class="setting-item">
                            <label for="apiEndpoint">API Endpoint</label>
                            <input type="url" id="apiEndpoint" value="http://localhost:8000/api">
                        </div>
                        <div class="setting-item">
                            <label for="wsEndpoint">WebSocket Endpoint</label>
                            <input type="url" id="wsEndpoint" value="ws://localhost:8000/ws">
                        </div>
                        <div class="setting-item">
                            <label for="maxDevices">Maximum Devices</label>
                            <input type="number" id="maxDevices" value="10" min="1" max="100">
                        </div>
                        <div class="setting-item">
                            <label class="switch">
                                <input type="checkbox" id="debugMode">
                                <span class="slider"></span>
                            </label>
                            <span>Debug Mode</span>
                        </div>
                    </div>
                    
                    <div class="settings-actions">
                        <button class="btn primary" id="saveSettingsBtn">Save Settings</button>
                        <button class="btn secondary" id="resetSettingsBtn">Reset to Default</button>
                        <button class="btn danger" id="exportDataBtn">Export Data</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Notification Panel -->
    <div class="notification-panel" id="notificationPanel">
        <div class="notification-header">
            <h3>Notifications</h3>
            <button class="close-btn" id="closeNotifications">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="notification-list" id="notificationList">
            <!-- Notifications will be populated by JavaScript -->
        </div>
    </div>

    <!-- Modal Overlay -->
    <div class="modal-overlay" id="modalOverlay"></div>
    
    <!-- Add Device Modal -->
    <div class="modal" id="addDeviceModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Device</h3>
                <button class="close-btn" id="closeAddDeviceModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="addDeviceForm" class="modal-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="deviceName">Device Name</label>
                        <input type="text" id="deviceName" name="deviceName" required>
                    </div>
                    <div class="form-group">
                        <label for="deviceId">Device ID</label>
                        <input type="text" id="deviceId" name="deviceId" required>
                    </div>
                    <div class="form-group">
                        <label for="deviceModel">Model</label>
                        <input type="text" id="deviceModel" name="deviceModel">
                    </div>
                    <div class="form-group">
                        <label for="deviceManufacturer">Manufacturer</label>
                        <select id="deviceManufacturer" name="deviceManufacturer">
                            <option value="">Select Manufacturer</option>
                            <option value="samsung">Samsung</option>
                            <option value="google">Google</option>
                            <option value="oneplus">OnePlus</option>
                            <option value="xiaomi">Xiaomi</option>
                            <option value="huawei">Huawei</option>
                            <option value="lg">LG</option>
                            <option value="motorola">Motorola</option>
                            <option value="sony">Sony</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="androidVersion">Android Version</label>
                        <input type="text" id="androidVersion" name="androidVersion" placeholder="e.g., 13">
                    </div>
                    <div class="form-group">
                        <label for="connectionType">Connection Type</label>
                        <select id="connectionType" name="connectionType">
                            <option value="adb">ADB</option>
                            <option value="wifi">WiFi ADB</option>
                            <option value="usb">USB</option>
                            <option value="emulator">Emulator</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="ipAddress">IP Address (if applicable)</label>
                        <input type="text" id="ipAddress" name="ipAddress" placeholder="192.168.1.100">
                    </div>
                    <div class="form-group">
                        <label for="port">Port (if applicable)</label>
                        <input type="number" id="port" name="port" placeholder="5555">
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn secondary" id="cancelAddDevice">Cancel</button>
                    <button type="submit" class="btn primary">Add Device</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Device Details Modal -->
    <div class="modal" id="deviceDetailsModal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3 id="deviceDetailsTitle">Device Details</h3>
                <button class="close-btn" id="closeDeviceDetailsModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="deviceDetailsContent">
                <!-- Device details will be populated by JavaScript -->
            </div>
        </div>
    </div>
    
    <!-- Security Center Modal -->
    <div class="modal" id="securityModal">
        <div class="modal-content large">
            <div class="modal-header">
                <h3>Security Scan Results</h3>
                <button class="close-btn" id="closeSecurityModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="securityModalContent">
                <div class="security-scan-progress" id="securityScanProgress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="securityProgressFill"></div>
                    </div>
                    <p id="securityProgressText">Initializing security scan...</p>
                </div>
                <div class="security-results" id="securityResults" style="display: none;">
                    <!-- Security results will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Confirmation Dialog -->
    <div class="modal" id="confirmationModal">
        <div class="modal-content small">
            <div class="modal-header">
                <h3 id="confirmationTitle">Confirm Action</h3>
            </div>
            <div class="modal-body">
                <p id="confirmationMessage">Are you sure you want to proceed?</p>
            </div>
            <div class="modal-actions">
                <button class="btn secondary" id="confirmationCancel">Cancel</button>
                <button class="btn danger" id="confirmationConfirm">Confirm</button>
            </div>
        </div>
    </div>

    <!-- JavaScript Files - Load in Safe Mode -->
    <script>
        // Prevent multiple initializations and clear any existing intervals
        if (window.androidZenInitialized) {
            console.warn('AndroidZen already initialized, preventing duplicate initialization');
        } else {
            window.androidZenInitialized = true;
            
            // Emergency cleanup - clear any existing intervals
            const highestIntervalId = setInterval(function(){}, 1);
            for (let i = 0; i < highestIntervalId; i++) {
                clearInterval(i);
            }
            
            console.log('AndroidZen Pro Dashboard starting in safe mode');
        }
    </script>
    
    <!-- Load only essential scripts -->
    <script src="../static/js/websocket.js" defer></script>
    <script src="../static/js/charts.js" defer></script>
    <script src="../static/js/dashboard.js" defer></script>
    <script src="../static/js/main.js" defer></script>
    
    <!-- Performance monitoring -->
    <script>
        // Monitor performance and prevent hanging
        let performanceTimer = 0;
        const performanceMonitor = setInterval(() => {
            performanceTimer++;
            if (performanceTimer > 30) { // After 30 seconds, reduce activity
                if (window.Charts && window.Charts.stopDemoMode) {
                    window.Charts.stopDemoMode();
                }
                if (window.Dashboard && window.Dashboard.stopDemoMode) {
                    window.Dashboard.stopDemoMode();
                }
                clearInterval(performanceMonitor);
            }
        }, 1000);
        
        // Page visibility API to pause when tab is not active
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // Page is hidden, pause demo modes
                if (window.Charts && window.Charts.stopDemoMode) {
                    window.Charts.stopDemoMode();
                }
                if (window.Dashboard && window.Dashboard.stopDemoMode) {
                    window.Dashboard.stopDemoMode();
                }
            }
        });
    </script>
</body>
</html>
